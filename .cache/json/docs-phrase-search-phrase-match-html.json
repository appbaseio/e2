{
    "data": {
        "markdownRemark": {
            "html": "<h1 id=\"phrase-search\"><a href=\"#phrase-search\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Phrase Search</h1>\n<p>This article is a part of the series on <a href=\"https://appbaseio.gitbooks.io/esc/content/phrase-search/introduction.html\"><strong>How to build phrase search engine using Elasticsearch?</strong></a></p>\n<p>Phrase search is useful when the order of the keywords in our query matter. Using <code>match_phrase</code> query of Elasticsearch users can easily provide the list of keywords in some specific order to search for documents containing an exact sentence or phrase which contains those keywords in the same order rather than comparing a set of keywords in random order.</p>\n<h3 id=\"how-to-do-phrase-search\"><a href=\"#how-to-do-phrase-search\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How to do phrase search</h3>\n<p>Like the <a href=\"https://appbaseio.gitbooks.io/esc/content/searchbar/simple-match.html\">match query</a>, the <code>match_phrase</code> query first analyzes the query string according to the defined analyzer to produce a list of terms. It then searches for all the terms, but keeps only documents that contain all of the search terms, in the same positions relative to each other. Our sample dataset contains comments, posts etc. Elasticsearch provides special analyzers to deal with language specific texts.</p>\n<p>In the following sections, we will go through the process of building a very simple phrase search for the Hackernews dataset.</p>\n<h2 id=\"defining-mappings\"><a href=\"#defining-mappings\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Defining Mappings</h2>\n<p>If you have worked with a SQL database system before, you are probably familiar with the idea of a schema. Elasticsearch’s equivalent of a schema definition is a mapping.</p>\n<p>By default, Elasticsearch analyzes the data before storing it on disk. It has different tokenizer, analyzer and filters to modify the data. Mappings are useful to attach these analyzers with specific fields. At index time, by default Elasticsearch uses the standard analyzer. Standard analyzer tokenizes the strings and converts it to the lower case tokens.</p>\n<p>We will use default English analyzer at the index time which can apply stemming, remove stop words, add synonyms to give us better results.</p>\n<h3 id=\"english-analyzer\"><a href=\"#english-analyzer\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>English Analyzer</h3>\n<p>The default analyzer of Elasticsearch contains following components:</p>\n<ul>\n<li><strong>Tokenizer</strong>: Splits the text into individual words by space or defined grammar.</li>\n<li><strong>TokenFilters</strong>: Filters the tokenized words. It lowercases all tokens, removes stop words, removes redundant tokens etc.</li>\n</ul>\n<p>English analyzer analyzes the text in the following way. Example text - “I’m not happy about the foxes\n“.</p>\n<ul>\n<li>First it tokenizes the text into words - [I’m, not, happy, about, the, foxes]</li>\n<li>Lowercases tokens: [i’m, not, happy, about, the, foxes]</li>\n<li>Removes stopwords: [i’m, happy, about, foxes]</li>\n<li>Stems tokens to their root form: [i’m, happi, about, fox]</li>\n</ul>\n<p>By using the english analyzer, we can match text more loosely. By default Elasticsearch uses same analyzer at index time and search time to ensure that the terms in the query are in the same format as the terms in the index.</p>\n<p>Now, we will specify the mappings for our <code>text</code> field. Elasticsearch will create mappings dynamically for the rest of the fields.</p>\n<h3 id=\"put-mappings\"><a href=\"#put-mappings\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Put Mappings</h3>\n<p>Define the English analyzer on the <code>text</code> field to analyze it at index time.</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsxon\"><code>curl -XPUT $host/hackernews/_mapping/post -d '{\n  \"properties\": {\n    \"text\": {\n      \"type\": \"string\",\n      \"analyzer\": \"english\"\n    }\n  }\n}'</code></pre>\n      </div>\n<p>We just put <strong>mapping</strong> on <code>post</code> type of <code>hackernews</code> index. Now, let’s index some data.</p>\n<h2 id=\"data-indexing\"><a href=\"#data-indexing\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Data Indexing</h2>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsxon\"><code>curl -XPUT $host/hackernews/_mapping/post -d '{\n  \"by\": \"dmihal\",\n  \"id\": 13102152,\n  \"parent\": 13101870,\n  \"text\": \"Cool library! I&#x27;m a huge fan of Meteor.js, which provides a similar isomorphic database. Cool to see this implemented in such a lightweight package!\",\n  \"time\": 1480890919,\n  \"p_type\": \"comment\",\n  \"score\": 0\n}'</code></pre>\n      </div>\n<p>We just indexed our first document. We already created sample database. You can tryout your own queries against it. Checkout our next section to play with it.</p>\n<h2 id=\"data-browser-view\"><a href=\"#data-browser-view\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Data Browser View</h2>\n<p>For accessibility, we have indexed ~6000 data points of Github repos that can be viewed in the data browser <a href=\"https://opensource.appbase.io/dejavu/live/#?input_state=XQAAAALxAAAAAAAAAAA9iIqnY-B2BnTZGEQz6wkFsyS2qaEZIwD-J9none24PyYH8yBXUWZ1fjjzdmdQqiDSYIwX4TuBH3IQtfCk1YLwT0kR9-r0YWMhn1GxDTldPTCD836HnpPYGINlfz27teRoEy1L78YMlLzUoLIYWjaUV04UwEet4YmZw_ADbiLDT1RhM_1XOaFqFsgEhHTBnHFMCY5VI4poDJz0BABqDSKR5qF76qvBs6Smde9lws1D6g_epJiEVMK0611dw8BoWkl1yP-N1SAA\">here. <img src=\"http://i.imgur.com/x7nLB9s.png\"></a></p>\n<h2 id=\"query\"><a href=\"#query\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Query</h2>\n<p>Next, we will move to the queries section. Here, we will be using <code>match_phrase</code> query to match the phrases. <code>match_phrase</code> query first analyze the provided text using the explicit defined analyzer, or using the default search analyzer and produces a list of terms.</p>\n<h3 id=\"exact-phrase-match\"><a href=\"#exact-phrase-match\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exact-phrase match</h3>\n<p>In order to match all the terms consecutively in the same order relative to each other use default <code>match_phrase</code> query.</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsxon\"><code>curl $host/hackernews/post/_search?pretty -d '{\n  \"query\": {\n    \"match_phrase\" : {\n      \"text\": \"Cool library\"\n    }\n  }\n}'</code></pre>\n      </div>\n<p>Here, <code>text</code> is the Elasticsearch field against which we performed the phrase match query.</p>\n<h3 id=\"mix-search\"><a href=\"#mix-search\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mix Search</h3>\n<p>Every time we can’t expect that users will provide the exact query terms with the proper order. Elasticsearch provides a way to match the documents even though the term’s positions aren’t exactly equivalent.</p>\n<p>We can pass the <code>slop</code> parameter in the following way to match the documents which contain all the query terms but in a different order or may be with the distance between them.</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsxon\"><code>curl $host/hackernews/post/_search?pretty -d '{\n  \"query\": {\n    \"match_phrase\": {\n      \"text\": {\n        \"query\": \"Cool library Meteor.js\",\n        \"slop\": 7\n      }\n    }\n  }\n}'</code></pre>\n      </div>\n<p>You can run above query and can get the matched document. If you check out the inserted document, the difference between the position of <code>\"Cool library\"</code> and <code>\"Meteor.js\"</code> will be the 7 words.</p>\n<h4 id=\"response\"><a href=\"#response\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Response</h4>\n<div class=\"gatsby-highlight\">\n      <pre class=\"gatsby-code-jsxon\"><code>{\n  \"took\" : 21,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 1,\n    \"successful\" : 1,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 1,\n    \"max_score\" : 1.5155549,\n    \"hits\" : [ {\n      \"_index\" : \"hackernews\",\n      \"_type\" : \"post\",\n      \"_id\" : \"AVtNnwdOtBk7_I4P_hnC\",\n      \"_score\" : 1.5155549,\n      \"_source\" : {\n        \"by\" : \"dmihal\",\n        \"id\" : 13102152,\n        \"parent\" : 13101870,\n        \"text\" : \"Cool library! I&#x27;m a huge fan of Meteor.js, which provides a similar isomorphic database. Cool to see this implemented in such a lightweight package!\",\n        \"time\" : 1480890919,\n        \"p_type\" : \"comment\",\n        \"score\" : 0\n      }\n    } ]\n  }\n}</code></pre>\n      </div>",
            "frontmatter": {
                "title": "",
                "next": null,
                "prev": null,
                "nextTitle": null,
                "prevTitle": null
            },
            "fields": {
                "path": "docs/phrase-search/phrase_match.md",
                "slug": "/docs/phrase-search/phrase_match.html"
            }
        }
    },
    "pathContext": {
        "slug": "/docs/phrase-search/phrase_match.html"
    }
}