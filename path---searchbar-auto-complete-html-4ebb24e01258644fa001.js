webpackJsonp([0x6a51883bae53],{436:function(e,t){e.exports={data:{markdownRemark:{html:'<p>This article is a part of the series on <a href="https://appbaseio.gitbooks.io/esc/content/searchbar/introduction.html"><strong>how to build a search bar</strong></a>.</p>\n<h3 id="how-to-build-a-search-as-you-type-autocompletion-view"><a href="#how-to-build-a-search-as-you-type-autocompletion-view" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to build a search-as-you-type autocompletion view</h3>\n<p>In this post, we will show how to provide an auto-completion of the inputs <strong>as the user types</strong> in a searchbar. We will be using a dataset containing a list of cities and countries and we will be building this feature using Elasticsearch’s <strong>completion</strong> type <code>field</code>.</p>\n<p><code>Note:</code> Alternate approaches can be implemented using n-grams and prefix suggester algorithms. But speed is the most important aspect for this feature. We’re making suggestions while the user types, so results need to be shown to the user within milliseconds. When using the completion type, Elasticsearch indexes data into a trie like data structure (called FST) which is optimized for fast retrieval and memory usage.</p>\n<h2 id="defining-mappings"><a href="#defining-mappings" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Defining Mappings</h2>\n<p>If you have worked with a SQL database system before, you are probably familiar with the idea of a schema. Elasticsearch’s equivalent of a schema definition is a mapping.</p>\n<p>In this section, we will specify the mappings for our two fields: city and country, with the necessary settings to enable auto-complete functionality.</p>\n<h3 id="updating-mappings"><a href="#updating-mappings" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Updating Mappings</h3>\n<p>Next, we will update the mapping for the <strong>city</strong> and <strong>country</strong> fields. We will exploit a very cool feature of Elasticsearch called <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/multi-fields.html"><strong>multi-fields</strong></a> in doing so. Multi-fields enable indexing the same field in different ways, thus allowing for multiple ways of querying without requiring any additional effort in indexing of the data.</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsxon"><code>curl -XPUT $host/normal_searchbar/_mapping/searchbar -d \'{\n  "properties": {\n    "city": {\n      "type": "text",\n      "fields": {\n        "city_autocomplete": {\n          "type": "completion",\n          "analyzer": "simple",\n          "search_analyzer": "simple"\n        }\n      }\n    },\n    "country": {\n      "type": "text",\n      "fields": {\n        "country_autocomplete": {\n          "type": "completion",\n          "analyzer": "simple",\n          "search_analyzer": "simple"\n        }\n      }\n    }\n  }\n}\'</code></pre>\n      </div>\n<p>Here, we have defined a multi-field for both <code>city</code> and <code>country</code> fields. The <code>city_autocomplete</code> field (inner field) has a type <strong>completion</strong> while the <code>city</code> field (outer field) has a type <strong>text</strong> and both are indexed simultaneously. We also use the <code>simple</code> analyzer that tokenizes the text as is (i.e. no white space splitting) and applies a lowercase filter for both indexing and searching on the *_autocomplete inner fields.</p>\n<h2 id="data-indexing"><a href="#data-indexing" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Data Indexing</h2>\n<p>As you can see, while indexing the data, we only need to insert the <strong>city</strong> and <strong>country</strong> fields.</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsxon"><code>curl -XPUT $host/normal_searchbar/searchbar/1 -d \'{\n  "city": "New York",\n  "country": "United States"\n}\'</code></pre>\n      </div>\n<h2 id="data-browser-view"><a href="#data-browser-view" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Data Browser View</h2>\n<p>For better accessibility, we have indexed ~15,000 data points that can be viewed in the data browser <a href="https://opensource.appbase.io/dejavu/live/#?input_state=XQAAAALvAAAAAAAAAAA9iIqnY-B2BnTZGEQz6wkFslF8ZMg7A6kGLFGPADbJVmb5ysVqinQQuiFLkb4deUgCDkj3Ca7c1o_y8XA0-MkniaJtriPLcO0sOs-he9RgZSsY1-Dj7M1oUHcSMXEdlL__k05smSCpzBnTIbIxXMyoFoHyy8Z_g-Ku8eQnTdtXdsrQgMg_wmz9OmY-26TdzjLWp-v2Wf1WiRDeMXYvBl1QvLH_j_iLGk7AkFU5rmsqyCR3BmLVt2baZT9KRDsA_8PvEAA&#x26;editable=false">here. <img src="https://i.imgur.com/rHOEixS.png"></a></p>\n<h2 id="query"><a href="#query" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Query</h2>\n<p>Next, we will move to the queries section. Here, we will be using the <strong>completion</strong> suggestor query for getting the autocomplete suggestions. You can read more about it <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-suggesters-completion.html">here</a>.</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsxon"><code>curl "$host/normal_searchbar/searchbar/_search?size=0&pretty" -d \'{\n  "suggest": {\n    "city-suggest": {\n      "text": "new y",\n      "completion": {\n        "field": "city.city_autocomplete"\n      }\n    }\n  }\n}\'</code></pre>\n      </div>\n<p>Here, <code>text</code> is the actual text that the user has typed so far and <code>completion</code> contains the field in which Elasticsearch will look for completion suggestions.</p>\n<h5 id="response"><a href="#response" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Response</h5>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsxon"><code>{\n  "took" : 20,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 1,\n    "successful" : 1,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : 15506,\n    "max_score" : 0.0,\n    "hits" : [ ]\n  },\n  "suggest" : {\n    "city-suggest" : [ {\n      "text" : "new y",\n      "offset" : 0,\n      "length" : 5,\n      "options" : [ {\n        "text" : "New York",\n        "score" : 1.0\n      } ]\n    } ]\n  }\n}</code></pre>\n      </div>\n<p>Voila! We can see “New York” as the suggestion which we can now display in the search box.</p>\n<h4 id="query-on-country"><a href="#query-on-country" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Query on Country</h4>\n<p>A similar query for suggestions on the <strong>country</strong> field would look like this:</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsxon"><code>curl "$host/normal_searchbar/searchbar/_search?size=0&pretty" -d \'{\n  "suggest": {\n    "country-suggest": {\n      "text": "united st",\n      "completion": {\n        "field": "country.country_autocomplete"\n      }\n    }\n  }\n}\'</code></pre>\n      </div>\n<h4 id="query-on-both-city-and-country"><a href="#query-on-both-city-and-country" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Query on both City and Country</h4>\n<p>What if we wanted to provide autocompletion on both <strong>city</strong> and <strong>country</strong> fields at the same time?</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsxon"><code>curl "$host/normal_searchbar/searchbar/_search?size=0&pretty" -d \'{\n  "suggest": {\n    "city-suggest": {\n      "text": "Chi",\n      "completion": {\n        "field": "city.city_autocomplete"\n      }\n    },\n    "country-suggest": {\n      "text": "Chi",\n      "completion": {\n        "field": "country.country_autocomplete"\n      }\n    }\n  }\n}\'</code></pre>\n      </div>\n<h5 id="response-1"><a href="#response-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Response</h5>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsxon"><code>{\n  "took" : 49,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 2,\n    "successful" : 2,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : 0,\n    "max_score" : 0.0,\n    "hits" : [ ]\n  },\n  "suggest" : {\n    "city-suggest" : [\n      {\n        "text" : "Chi",\n        "offset" : 0,\n        "length" : 3,\n        "options" : [\n          {\n            "text" : "Chiajna",\n            "_index" : "normal_searchbar",\n            "_type" : "searchbar",\n            "_id" : "AWDMLdpE5Q83Zq9GY7SX",\n            "_score" : 1.0,\n            "_source" : {\n              "city" : "Chiajna",\n              "country" : "Romania"\n            }\n          }\n        ]\n      }\n    ],\n    "country-suggest" : [\n      {\n        "text" : "Chi",\n        "offset" : 0,\n        "length" : 3,\n        "options" : [\n          {\n            "text" : "Chile",\n            "_index" : "normal_searchbar",\n            "_type" : "searchbar",\n            "_id" : "AWDMLep65Q83Zq9GY7hi",\n            "_score" : 1.0,\n            "_source" : {\n              "city" : "ViÃÂÃÂ±a del Mar",\n              "country" : "Chile"\n            }\n          }\n        ]\n      }\n    ]\n  }\n}</code></pre>\n      </div>\n<p>We can then pick the item with the highest score value: “China” in this case, and display it in the searchbox’s input section.</p>\n<p>We can also use the suggest query for building a search as-you-type suggestions feature by arranging the other items in a dropdown list. However, doing so has some limitations.</p>\n<ol>\n<li>We can’t detect suggestions on a full-text phrase if the user starts typing from the middle of the phrase or even the middle of the word.</li>\n<li>Prior to v5 of Elasticsearch, we couldn’t show additional fields of the document as a part of the suggestion UI (like images) since the <strong>completion suggest</strong> query only returns the field in question.</li>\n</ol>\n<hr>\n<p>Next, we talk about building a <a href="https://appbaseio.gitbooks.io/esc/content/searchbar/suggestions.html"><strong>search as-you-type suggestions</strong></a> feature using n-grams.</p>',frontmatter:{title:"Auto Complete",next:"suggestions.html",prev:"multi-match.html",nextTitle:"Suggestions",prevTitle:"Multi Match"},fields:{path:"docs/searchbar/auto-complete.md",slug:"searchbar/auto-complete.html"}}},pathContext:{slug:"searchbar/auto-complete.html"}}}});
//# sourceMappingURL=path---searchbar-auto-complete-html-4ebb24e01258644fa001.js.map